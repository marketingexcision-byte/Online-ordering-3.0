{% layout none %}
{% if search.terms == "* *"%}
{% assign numResults = 500 %}
{% else %}
{% assign numResults = 30 %}
{% endif %}
{% paginate search.results by numResults %}
{% capture output %}
{% if search.results_count > 0 %}
[{% for result in search.results  %}
{% if result.metafields.inventory.ShappifyHidden == "true" or result.tags contains "SearchHiddenMyProduct" %}
{% else %}
{% assign resultURL = result.url %}
{% assign thumbURL = result.images[0] | product_img_url: 'thumb' %}{                
"title":"{% include 'json_clean_up' with result.title %}",                    
"price":"{{ result.price | money_with_currency | replace: '"', '\"' }}",                   
"price2":"{% if result.compare_at_price > result.price %}{{ result.compare_at_price  | money_with_currency | replace: '"', '\"' }}{% endif %}","url":"{% include 'json_clean_up' with resultURL %}","thumb":"{% include 'json_clean_up' with thumbURL %}","id":{{result.id}}
{% if forloop.last == true %}
}]
{% else %}
},
{% endif %}
{% endif %}
{% endfor %}
{%else%}{[ ]}
{% endif %}
{% endcapture %}
{% comment %} 
Enclose in square brackets and output the json object 
{% endcomment %}
{% comment %} 
{{ output | strip_newlines | prepend: '[' | append: ']' }} {% endcomment %}
{{ output | strip_newlines }}{% endpaginate %}