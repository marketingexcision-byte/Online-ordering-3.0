{% liquid
  assign selected_collections = blank
  if page and page.metafields.custom.collection_grid_collections and page.metafields.custom.collection_grid_collections.value != blank
    assign selected_collections = page.metafields.custom.collection_grid_collections.value
  endif

  assign heading = section.settings.heading | default: page.title
  assign intro = section.settings.intro
  assign show_page_content = section.settings.show_page_content and page and page.content != blank
  assign button_label = section.settings.button_label | default: 'Shop collection'
%}

<section class="section section--collections-grid" aria-labelledby="collection-grid-heading">
  <div class="layout-constrained">
    {% if heading != blank or intro != blank or show_page_content %}
      <header class="section__header">
        {% if heading != blank %}
          <h1 id="collection-grid-heading" class="section__title text-h2">{{ heading | escape }}</h1>
        {% endif %}
        {% if intro != blank %}
          <div class="section__intro text-p1">{{ intro }}</div>
        {% endif %}
        {% if show_page_content %}
          <div class="section__content rte">{{ page.content }}</div>
        {% endif %}
      </header>
    {% endif %}

    {% if selected_collections != blank and selected_collections.size > 0 %}
      <div class="collection-grid" role="list">
        {% for collection in selected_collections %}
          {% liquid
            assign short_description = collection.metafields.custom.short_description
            assign collection_image = collection.image
            assign image_alt = ''
            if collection_image and collection_image.alt != blank
              assign image_alt = collection_image.alt
            else
              assign image_alt = collection.title
            endif
          %}
          <article class="collection-card" role="listitem">
            <div class="collection-card__media">
              {% if collection_image %}
                {{ collection_image | image_url: width: 960 | image_tag: class: 'collection-card__image', loading: 'lazy', widths: '320, 480, 640, 800, 960', sizes: '(min-width: 1080px) 320px, (min-width: 768px) 45vw, 90vw', alt: image_alt, decoding: 'async' }}
              {% else %}
                <div class="collection-card__placeholder text-p1" role="img" aria-label="{{ collection.title | escape }} image placeholder">Image coming soon</div>
              {% endif %}
            </div>
            <div class="collection-card__body">
              <h2 class="collection-card__title text-h4"><a href="{{ collection.url }}" class="collection-card__link">{{ collection.title }}</a></h2>
              {% if short_description != blank %}
                <p class="collection-card__description text-p1">{{ short_description | strip_html }}</p>
              {% endif %}
              <div class="collection-card__actions">
                <a class="btn btn-primary" href="{{ collection.url }}">{{ button_label | escape }}</a>
              </div>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <div class="collection-grid__empty text-p1">
        {{ 'No collections have been assigned to this page yet.' }}
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Collections grid",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop collections"
    },
    {
      "type": "richtext",
      "id": "intro",
      "label": "Intro text"
    },
    {
      "type": "checkbox",
      "id": "show_page_content",
      "label": "Show page content",
      "default": false
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Shop collection"
    }
  ],
  "presets": [
    {
      "name": "Collections grid"
    }
  ]
}
{% endschema %}
